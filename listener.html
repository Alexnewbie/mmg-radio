<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MMG Radio - Live Stream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      line-height: 1.6;
    }
    header {
      background: #6f42c1;
      padding: 20px;
      text-align: center;
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .player {
      text-align: center;
      margin-bottom: 40px;
    }
    .player img {
      width: 200px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      margin-bottom: 20px;
    }
    .btn {
      background: #6f42c1;
      color: #fff;
      border: none;
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn:hover {
      background: #9b51e0;
      transform: translateY(-2px);
    }
    .now-playing, .recently-played {
      margin-bottom: 30px;
    }
    .recently-played li {
      list-style: none;
      margin-bottom: 10px;
      padding: 8px;
      background: #222;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸŽ¶ MMG Radio</h1>
    <p>Live from Typical Media</p>
  </header>

  <div class="container">
    <div class="player">
      <img id="cover" src="https://via.placeholder.com/200" alt="Album Art">
      <h2 id="track-title">Loading...</h2>
      <p id="track-artist"></p>
      <audio id="audio" controls autoplay>
        <source src="https://cdnstream1.typicalmedia.net/mmgradio" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>

    <div class="now-playing">
      <h3>Now Playing</h3>
      <p><strong id="np-title">-</strong> by <span id="np-artist">-</span></p>
    </div>

    <div class="recently-played">
      <h3>Recently Played</h3>
      <ul id="recent-tracks"></ul>
    </div>
  </div>

  <script>
    async function fetchNowPlaying() {
      try {
        const res = await fetch("https://api.typicalmedia.net/api/v1/allnowplaying");
        const data = await res.json();

        // Find MMG Radio (id 166)
        const station = data.find(st => st.id == 166);
        if (!station) return;

        const now = station.now_playing.song;
        const history = station.song_history || [];

        // Update now playing
        document.getElementById("track-title").textContent = now.title || "Unknown Title";
        document.getElementById("track-artist").textContent = now.artist || "Unknown Artist";
        document.getElementById("np-title").textContent = now.title || "-";
        document.getElementById("np-artist").textContent = now.artist || "-";
        document.getElementById("cover").src = now.art || "https://via.placeholder.com/200";

        // Recently played
        const list = document.getElementById("recent-tracks");
        list.innerHTML = "";
        history.forEach(track => {
          const li = document.createElement("li");
          li.textContent = `${track.song.title} â€” ${track.song.artist}`;
          list.appendChild(li);
        });
      } catch (err) {
        console.error("Error fetching now playing:", err);
      }
    }

    // Refresh every 15s
    fetchNowPlaying();
    setInterval(fetchNowPlaying, 15000);
  </script>
</body>
</html>
