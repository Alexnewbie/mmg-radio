<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MMG Radio - Accessible Version</title>
<link rel="icon" href="./your-logo.png" />
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* High contrast background & text */
body {
  background-color:#000;
  color:#fff;
  font-family:sans-serif;
  line-height:1.6;
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
  }
}

/* Logo fade */
#loadingLogo { opacity:0; transition:opacity 1s ease-out; }
#loadingLogo.visible { opacity:1; }

/* Top-left logo */
#topLogo { opacity:0; transition:opacity 1s ease-out; top: 1rem; left: 2rem; }
#topLogo.visible { opacity:1; }

/* Live badge */
.live-badge {
  background: #ff0000;
  color:#fff; font-weight:bold;
  padding:2px 8px; border-radius:9999px;
  display:inline-flex; align-items:center; gap:4px;
}

/* Station Offline / Night Mode */
#stationOffOverlay {
  position: fixed; inset: 0;
  background: radial-gradient(circle at top, #0a0a2a, #000);
  display: none; justify-content: center; align-items: center;
  flex-direction: column; color: #fff; font-size: 3rem; font-weight: bold;
  z-index: 9998; overflow: hidden;
}

/* Star animation for offline */
.star { position:absolute; width:2px; height:2px; background:white; border-radius:50%;
animation: twinkle linear infinite, drift linear infinite; }
@keyframes twinkle {0%,100%{opacity:0.2;}50%{opacity:1;}}
@keyframes drift {0%{transform:translate(0,0);}100%{transform:translate(var(--dx),var(--dy));}}

/* Visualizer accessible */
#visualizer { border-radius:0.5rem; outline:2px solid #fff; }
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen" class="fixed inset-0 bg-black flex items-center justify-center z-[9999]" role="status" aria-live="polite">
  <img src="./your-logo.png" alt="Loading MMG Logo" class="h-24 w-24" id="loadingLogo">
</div>

<!-- Top-left logo -->
<div id="topLogo" class="fixed z-50">
  <img src="./your-logo.png" class="h-12 w-12 object-contain" id="logoImg" alt="MMG Radio Logo">
</div>

<!-- Station Offline Overlay -->
<div id="stationOffOverlay" role="alert" aria-live="assertive">Station Offline</div>

<!-- Sticky Audio Bar -->
<div id="audioBar" class="fixed bottom-3 left-1/2 -translate-x-1/2 z-50 w-[min(1100px,95vw)]" role="region" aria-label="Audio Player">
  <div class="bg-neutral-900/90 backdrop-blur border border-neutral-800 rounded-2xl p-3 shadow-2xl shadow-black/50">
    <div class="flex items-center gap-3">
      <button id="playBtn" class="h-11 w-11 rounded-full bg-brand-500 hover:bg-brand-400 grid place-items-center focus:outline focus:outline-2 focus:outline-white" aria-label="Play/Pause" aria-pressed="false">
        <svg id="iconPlay" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"/></svg>
        <svg id="iconPause" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/></svg>
      </button>
      <div class="min-w-0 flex-1">
        <div class="text-lg font-bold" id="nowTitle" aria-live="polite">—</div>
        <div class="text-sm" id="nowArtist" aria-live="polite">—</div>
        <div class="text-xs text-neutral-400 hidden" id="nowDJBar"></div>
      </div>
      <label class="flex items-center gap-2 text-sm" for="volume">
        Volume
        <input id="volume" type="range" min="0" max="1" step="0.01" value="0.7" aria-label="Volume Control">
      </label>
      <button id="requestBtnBar" class="text-sm bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 rounded-xl px-3 py-2 focus:outline focus:outline-2 focus:outline-white">Request Song</button>
      <a id="listenBtn" href="#" target="_blank" class="text-sm bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 rounded-xl px-3 py-2 focus:outline focus:outline-2 focus:outline-white">Open Stream</a>
    </div>
    <audio id="player" preload="none" crossorigin="anonymous" aria-label="Radio Stream Player"></audio>
  </div>
</div>

<!-- Now Playing -->
<section class="mx-auto max-w-6xl px-4 sm:px-6 py-12" role="region" aria-label="Now Playing Section">
  <div class="grid md:grid-cols-[120px,1fr] gap-6 items-center">
    <div class="aspect-square rounded-2xl overflow-hidden bg-neutral-800">
      <img id="nowArt" src="./your-logo.png" alt="Now playing artwork" class="h-full w-full object-cover">
    </div>
    <div>
      <h2 class="text-2xl font-bold flex items-center gap-3">On Air <span id="liveBadge" class="live-badge hidden">LIVE</span></h2>
      <p id="nowArtist" class="mt-2">—</p>
      <p id="nowTrack" class="text-lg font-semibold">—</p>
      <p id="djRow" class="text-sm hidden">DJ: <span id="djName"></span></p>
      <canvas id="visualizer" class="w-full h-20 mt-4 rounded-lg bg-neutral-800" aria-label="Audio Visualizer"></canvas>
    </div>
  </div>
</section>

<!-- Request Popup -->
<div id="requestPopupOverlay" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[9999]" role="dialog" aria-modal="true" aria-label="Request Song">
  <div class="w-11/12 max-w-md h-[70vh] bg-neutral-900 rounded-xl relative">
    <button id="requestPopupClose" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8" aria-label="Close Request Popup">&times;</button>
    <iframe id="requestIframe" src="request.html" class="w-full h-full border-0 rounded-xl" title="Request Song Form"></iframe>
  </div>
</div>

<script>
// Same JS as before with metadata, player, visualizer, and offline overlay
const API='https://azura.typicalmedia.net/api/nowplaying/mmg_radio';
const player=document.getElementById('player');
const playBtn=document.getElementById('playBtn'),iconPlay=document.getElementById('iconPlay'),iconPause=document.getElementById('iconPause');
const volume=document.getElementById('volume');
const nowTitle=document.getElementById('nowTitle'),nowArtist=document.getElementById('nowArtist'),nowTrack=document.getElementById('nowTrack'),nowArt=document.getElementById('nowArt');
const liveBadge=document.getElementById('liveBadge'),liveBadgeBar=document.getElementById('liveBadgeBar');
const djRow=document.getElementById('djRow'),djName=document.getElementById('djName'),nowDJBar=document.getElementById('nowDJBar');
const listenBtn=document.getElementById('listenBtn');
const requestBtnBar=document.getElementById('requestBtnBar');
const requestPopupOverlay=document.getElementById('requestPopupOverlay'),requestPopupClose=document.getElementById('requestPopupClose');
const visualizer=document.getElementById('visualizer');
const loadingScreen=document.getElementById('loadingScreen'),loadingLogo=document.getElementById('loadingLogo');
const stationOffOverlay=document.getElementById('stationOffOverlay');
const topLogo=document.getElementById('topLogo');

let currentStream=null,audioCtx,analyzer,sourceNode;

window.addEventListener('load',()=>{
  loadingLogo.classList.add('visible');
  setTimeout(()=>{loadingScreen.style.display='none'; topLogo.classList.add('visible');},1500);
});

function setPlayingUI(p){iconPlay.classList.toggle('hidden',p);iconPause.classList.toggle('hidden',!p);}
playBtn.onclick=async()=>{
  if(player.paused){
    try{
      if(!audioCtx){ audioCtx=new(window.AudioContext||window.webkitAudioContext)(); analyzer=audioCtx.createAnalyser(); sourceNode=new MediaElementAudioSourceNode(audioCtx, {mediaElement:player}); sourceNode.connect(analyzer); analyzer.connect(audioCtx.destination); startVisualizer(); }
      else if(audioCtx.state==='suspended'){await audioCtx.resume();}
      await player.play(); setPlayingUI(true);
    } catch(e){ console.warn(e); }
  } else{ player.pause(); setPlayingUI(false); }
};
volume.oninput=e=>player.volume=parseFloat(e.target.value);

requestBtnBar.onclick=()=>{requestPopupOverlay.classList.remove('hidden');};
requestPopupClose.onclick=()=>{requestPopupOverlay.classList.add('hidden');};
requestPopupOverlay.onclick=e=>{if(e.target===requestPopupOverlay) requestPopupOverlay.classList.add('hidden');};

async function fetchNow(){
  try{
    let r=await fetch(API,{cache:'no-store'}),d=await r.json();
    let songTitle=d.now_playing.song.title || '—';
    nowTitle.textContent=d.station.name || 'MMG Radio';
    nowTrack.textContent=songTitle;
    nowArtist.textContent=d.now_playing.song.artist || '—';
    let art=d.now_playing.song.art; if(art) nowArt.src=art;
    let dj=d.live.streamer_name||d.now_playing.dj;
    if(dj){ djRow.classList.remove('hidden'); djName.textContent=dj; nowDJBar.textContent=dj; nowDJBar.classList.remove('hidden'); }
    else{ djRow.classList.add('hidden'); nowDJBar.classList.add('hidden'); }
    let live=d.live.is_live;
    liveBadge.classList.toggle('hidden',!live); liveBadgeBar.classList.toggle('hidden',!live);
    let stream=d.station.listen_url;
    if(stream && stream!==currentStream){ currentStream=stream; player.src=currentStream; listenBtn.href=currentStream; listenBtn.classList.remove('hidden'); requestBtnBar.classList.remove('hidden'); }

    stationOffOverlay.style.display = songTitle.toLowerCase().includes("station offline") ? "flex" : "none";

  } catch(e){ console.warn('API error',e);}
  setTimeout(fetchNow,7000);
}

function startVisualizer(){
  const ctx=visualizer.getContext('2d');
  function resize(){ visualizer.width=visualizer.clientWidth; visualizer.height=visualizer.clientHeight; }
  resize(); window.addEventListener('resize',resize);
  function draw(){
    requestAnimationFrame(draw);
    let arr=new Uint8Array(analyzer.frequencyBinCount);
    analyzer.getByteFrequencyData(arr);
    ctx.clearRect(0,0,visualizer.width,visualizer.height);
    let barWidth=Math.max(2,visualizer.width/arr.length*2),x=0;
    for(let i=0;i<arr.length;i+=4){ let v=arr[i]/255; let h=v*visualizer.height; ctx.fillStyle=`hsl(${280-v*100},80%,50%)`; ctx.fillRect(x,visualizer.height-h,barWidth,h); x+=barWidth+1; }
  }
  draw();
}

fetchNow();
</script>
</body>
</html>
