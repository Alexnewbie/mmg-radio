<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AzuraCast Player Setup Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ensures smooth scrolling when triggers are clicked */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* Changed background to light gray */
            color: #1f2937;
        }
        .container { max-width: 1000px; }
        code { font-size: 0.875rem; }
        
        /* Code Block Styles */
        .code-block-container {
            position: relative;
            background-color: #1f2937;
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .code-block-container pre {
            color: #d1d5db;
        }
        .copy-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 10;
        }
        .copy-button:hover { background-color: #2563eb; }

        /* INTERACTIVE GUIDE ELEMENTS */

        /* Styles for the ? trigger icons */
        .help-trigger {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #f59e0b; /* Yellow/Amber color */
            color: white;
            font-size: 14px;
            font-weight: bold;
            margin-left: 8px;
            transition: background-color 0.2s, transform 0.2s;
            z-index: 20;
        }
        .help-trigger:hover {
            background-color: #d97706;
            transform: scale(1.1);
        }

        /* Styles for the pulsating scroll down arrow */
        .scroll-arrow {
            display: block;
            position: absolute;
            width: 30px;
            height: 30px;
            background: #ef4444; /* Red color */
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: bounce 1.5s infinite;
            z-index: 50; 
            top: auto;
            bottom: 2rem;
            right: 2rem;
        }
        .scroll-arrow:hover {
            background: #dc2626;
        }
        .scroll-arrow svg {
            display: block;
            color: white;
            width: 100%;
            height: 100%;
            padding: 6px;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
            60% {
                transform: translateY(-4px);
            }
        }
        
        /* Helper styles for the Player Demo to match the aesthetic */
        .live-badge {
            text-xs font-bold px-2 py-0.5 rounded-full bg-red-600 text-white animate-pulse;
        }
        #stationOffOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; 
            align-items: center;
            justify-content: center;
            z-index: 30;
            color: white;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        /* Loading/Logo transitions */
        /* FIX: Start hidden by default to ensure the guide content is visible if JS is slow */
        #loadingScreen { opacity: 1; transition: opacity 0.5s ease-out; display: none; }
        
        #loadingLogo { transform: scale(0.5); opacity: 0; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        #loadingLogo.visible { transform: scale(1); opacity: 1; }
        #topLogo { top: 1rem; left: 1rem; opacity: 0; transform: translateX(-50px); transition: opacity 0.5s ease-in, transform 0.5s ease-in; }
        #topLogo.visible { opacity: 1; transform: translateX(0); }

        /* Star field for offline overlay (simplified for brevity) */
        .star {
            position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%; opacity: 0; animation: twinkle 5s linear infinite;
        }
        @keyframes twinkle {
            0% { opacity: 0; transform: translate(0, 0); } 10% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 0; transform: translate(var(--dx), var(--dy)); }
        }
        
    </style>
</head>
<body class="bg-gray-100 text-gray-700"> <!-- Changed body class for visibility -->

    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-800">AzuraCast HTML Player Setup Guide</h1>
            <p class="mt-1 text-gray-500">Self-contained, real-time radio player with visualizer, built using Tailwind CSS.</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        
        <!-- Section 1: Introduction -->
        <section class="mb-12 p-6 bg-white rounded-xl shadow-lg relative text-gray-700">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2 text-gray-800">1. Project Overview & Essential Configuration</h2>
            <p class="text-lg">This is a single-file, fully responsive radio player that integrates with your **AzuraCast** instance. Use the interactive demo below (look for the <span class="text-amber-500 font-bold">?</span> icons) to jump directly to the setup steps!</p>
            <p class="mt-4 text-sm text-red-600 font-semibold" id="api-note">
                <strong class="text-xl">🛑 Crucial Note:</strong> The first step is **always** to replace the API link in the configuration block (Section 4) with your specific station's details.
            </p>
            <!-- New Arrow Indicator for API Setup (Scrolls to Step 1) -->
            <a href="#step-1-content" class="scroll-arrow transition-transform duration-300 hover:translate-y-1" aria-label="Go to API Setup Step">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </a>
        </section>

        <!-- Section 2: LIVE INTERACTIVE PLAYER DEMO -->
        <section class="mb-12 p-6 bg-black/90 rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2 text-white">2. Live Player Demo</h2>
            <!-- The actual player HTML is placed here so it runs live -->

            <!-- Loading Screen (Now hidden by default) -->
            <div id="loadingScreen" class="fixed inset-0 bg-black flex items-center justify-center z-[9999]">
                <!-- IMPORTANT: Replace with your actual logo file path -->
                <img src="https://placehold.co/96x96/1f2937/ffffff?text=LOGO" alt="Station Logo" class="h-24 w-24 rounded-full" id="loadingLogo">
            </div>

            <!-- Top-left persistent logo -->
            <div id="topLogo" class="fixed z-50">
                <!-- IMPORTANT: Replace with your actual logo file path -->
                <img src="https://placehold.co/48x48/1f2937/ffffff?text=L" class="h-12 w-12 object-contain rounded-lg shadow-lg" id="logoImg">
            </div>

            <!-- Station Offline Overlay -->
            <div id="stationOffOverlay">
                <div class="p-8 bg-black/50 rounded-xl text-center">
                    <p>Station Offline</p>
                    <p class="text-xl font-normal mt-4 text-gray-400">We'll be back soon!</p>
                </div>
            </div>

            <!-- Sticky Audio Bar (Always visible at the bottom) -->
            <div id="audioBar" class="fixed bottom-0 md:bottom-3 left-1/2 -translate-x-1/2 z-50 w-full md:w-[min(1100px,95vw)] p-2 md:p-0">
                <div class="bg-neutral-900/90 backdrop-blur border border-neutral-800 rounded-xl md:rounded-2xl p-3 shadow-2xl shadow-black/70">
                    <div class="flex items-center gap-3">
                        <button id="playBtn" class="h-11 w-11 flex-shrink-0 rounded-full bg-blue-500 hover:bg-blue-400 grid place-items-center transition-colors duration-200" aria-label="Play/Pause">
                            <!-- Play Icon (SVG) -->
                            <svg id="iconPlay" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="white" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"/>
                            </svg>
                            <!-- Pause Icon (SVG) -->
                            <svg id="iconPause" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/>
                            </svg>
                        </button>

                        <!-- Track Info -->
                        <div class="min-w-0 flex-1">
                            <div class="text-xs md:text-sm text-neutral-400">Now Playing <span id="liveBadgeBar" class="live-badge hidden">LIVE</span></div>
                            <div id="nowTitleBar" class="truncate font-semibold text-white transition-all duration-300">—</div>
                            <div id="nowArtistBar" class="truncate text-neutral-400 text-sm transition-all duration-300">—</div>
                            <div id="nowDJBar" class="text-xs text-neutral-400 hidden"></div>
                        </div>

                        <!-- Volume Control -->
                        <div class="hidden sm:flex items-center gap-2 text-xs text-neutral-400">
                            <span class="w-10">Volume</span>
                            <input id="volume" type="range" min="0" max="1" step="0.01" class="w-24 md:w-32" value="0.7">
                        </div>

                        <!-- Request and Listen Buttons -->
                        <button id="requestBtnBar" class="hidden sm:inline-flex flex-shrink-0 text-sm bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 rounded-xl px-3 py-2 transition-colors duration-200">Request Song</button>
                        
                        <!-- Help Trigger for Requests -->
                        <span id="helpRequests" class="help-trigger" data-target="step-3-content" aria-label="Configure Request URL">?</span> 
                    </div>
                    <audio id="player" preload="none" crossorigin="anonymous"></audio>
                </div>
            </div>

            <!-- Main Content (Now Playing Section) -->
            <div class="mx-auto max-w-6xl px-4 sm:px-6 py-12 pb-32 md:pb-24">
                <div class="grid md:grid-cols-[200px,1fr] gap-8 items-start">
                    <!-- Artwork -->
                    <div class="aspect-square w-full rounded-2xl overflow-hidden bg-neutral-800 shadow-xl mx-auto md:mx-0 relative">
                        <!-- Help Trigger for Artwork -->
                        <span id="helpArtwork" class="help-trigger absolute top-2 right-2 z-30" data-target="step-4-content" aria-label="Configure Artwork Paths">?</span>
                        <!-- IMPORTANT: Replace with a local placeholder image path -->
                        <img id="nowArt" src="https://placehold.co/200x200/4b5563/ffffff?text=ALBUM+ART" alt="Now playing artwork" class="h-full w-full object-cover transition-all duration-500 hover:scale-[1.03]">
                    </div>
                    
                    <!-- Track Details and Visualizer -->
                    <div>
                        <h2 class="text-3xl font-bold flex items-center gap-3">
                            <span id="stationNameHeaderDemo">YOUR STATION</span> 
                            <!-- Help Trigger for Station Name -->
                            <span id="helpStationName" class="help-trigger" data-target="step-2-content" aria-label="Configure Station Name">?</span> 
                            <span id="liveBadge" class="live-badge hidden">LIVE</span>
                        </h2>
                        <p id="nowArtistMainDemo" class="mt-2 text-neutral-400 text-lg transition-all duration-300">—</p>
                        <p id="nowTrackMainDemo" class="text-xl font-semibold transition-all duration-300">—</p>
                        <p id="djRow" class="text-sm text-neutral-400 hidden mt-1">DJ: <span id="djName"></span></p>
                        
                        <!-- Visualizer -->
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold mb-2">Audio Visualizer</h3>
                            <canvas id="visualizer" class="w-full h-24 rounded-lg bg-neutral-800 shadow-inner"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request Popup (Frame for AzuraCast Requests) -->
            <div id="requestPopupOverlay" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[9999]">
                <div class="w-11/12 max-w-lg h-[90vh] bg-neutral-900 rounded-xl relative overflow-hidden shadow-2xl">
                    <button id="requestPopupClose" class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full w-8 h-8 z-10 text-2xl leading-none transition-colors duration-200">&times;</button>
                    <iframe id="requestIframe" src="" frameborder="0" allowtransparency="true" class="w-full h-full"></iframe>
                </div>
            </div>

        </section>

        <!-- Section 3: The Complete Code (For Copying) -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2 text-gray-800">3. The Complete Code (`index.html`)</h2>
            <p class="mb-4 text-gray-600">Copy the entire block below. This file is self-contained and requires no other external files.</p>

            <div class="code-block-container">
                <button class="copy-button" onclick="copyCode()">Copy Code</button>
                <pre><code id="playerCodeBlock">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
&lt;title&gt;Your Station Name | Live Player&lt;/title&gt;
&lt;!-- IMPORTANT: Replace with your actual logo file path --&gt;
&lt;link rel="icon" href="./assets/logo.png" /&gt;
&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;

&lt;style&gt;
/* CUSTOM CSS STYLES FOR THE PLAYER LOOK AND FEEL */
.live-badge {
    text-xs font-bold px-2 py-0.5 rounded-full bg-red-600 text-white animate-pulse;
}
#stationOffOverlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: none; align-items: center; justify-content: center; z-index: 30;
    color: white; overflow: hidden; background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
}
/* Loading/Logo transitions */
#loadingScreen { opacity: 1; transition: opacity 0.5s ease-out; display: none; } /* Set to display: none for immediate visibility in preview */
#loadingLogo { transform: scale(0.5); opacity: 0; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
#loadingLogo.visible { transform: scale(1); opacity: 1; }
#topLogo { top: 1rem; left: 1rem; opacity: 0; transform: translateX(-50px); transition: opacity 0.5s ease-in, transform 0.5s ease-in; }
#topLogo.visible { opacity: 1; transform: translateX(0); }

/* Star field for offline overlay (simplified for brevity) */
.star {
    position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%; opacity: 0; animation: twinkle 5s linear infinite;
}
@keyframes twinkle {
    0% { opacity: 0; transform: translate(0, 0); } 10% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 0; transform: translate(var(--dx), var(--dy)); }
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body class="bg-black text-white"&gt;

&lt;!-- Loading Screen --&gt;
&lt;div id="loadingScreen" class="fixed inset-0 bg-black flex items-center justify-center z-[9999]"&gt;
    &lt;!-- IMPORTANT: Replace with your actual logo file path --&gt;
    &lt;img src="./assets/logo.png" alt="Station Logo" class="h-24 w-24 rounded-full" id="loadingLogo"&gt;
&lt;/div&gt;

&lt;!-- Top-left persistent logo --&gt;
&lt;div id="topLogo" class="fixed z-50"&gt;
    &lt;!-- IMPORTANT: Replace with your actual logo file path --&gt;
    &lt;img src="./assets/logo.png" class="h-12 w-12 object-contain rounded-lg shadow-lg" id="logoImg"&gt;
&lt;/div&gt;

&lt;!-- Station Offline Overlay --&gt;
&lt;div id="stationOffOverlay"&gt;
    &lt;div class="p-8 bg-black/50 rounded-xl text-center"&gt;
        &lt;p&gt;Station Offline&lt;/p&gt;
        &lt;p class="text-xl font-normal mt-4 text-gray-400"&gt;We'll be back soon!&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Sticky Audio Bar (Always visible at the bottom) --&gt;
&lt;div id="audioBar" class="fixed bottom-0 md:bottom-3 left-1/2 -translate-x-1/2 z-50 w-full md:w-[min(1100px,95vw)] p-2 md:p-0"&gt;
    &lt;div class="bg-neutral-900/90 backdrop-blur border border-neutral-800 rounded-xl md:rounded-2xl p-3 shadow-2xl shadow-black/70"&gt;
        &lt;div class="flex items-center gap-3"&gt;
            &lt;button id="playBtn" class="h-11 w-11 flex-shrink-0 rounded-full bg-blue-500 hover:bg-blue-400 grid place-items-center transition-colors duration-200" aria-label="Play/Pause"&gt;
                &lt;!-- Play Icon (SVG) --&gt;
                &lt;svg id="iconPlay" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="white" viewBox="0 0 24 24" stroke="currentColor"&gt;
                    &lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3l14 9-14 9V3z"/&gt;
                &lt;/svg&gt;
                &lt;!-- Pause Icon (SVG) --&gt;
                &lt;svg id="iconPause" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;
                    &lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"/&gt;
                &lt;/svg&gt;
            &lt;/button&gt;

            &lt;!-- Track Info --&gt;
            &lt;div class="min-w-0 flex-1"&gt;
                &lt;div class="text-xs md:text-sm text-neutral-400"&gt;Now Playing &lt;span id="liveBadgeBar" class="live-badge hidden"&gt;LIVE&lt;/span&gt;&lt;/div&gt;
                &lt;div id="nowTitleBar" class="truncate font-semibold text-white transition-all duration-300"&gt;—&lt;/div&gt;
                &lt;div id="nowArtistBar" class="truncate text-neutral-400 text-sm transition-all duration-300"&gt;—&lt;/div&gt;
                &lt;div id="nowDJBar" class="text-xs text-neutral-400 hidden"&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;!-- Volume Control --&gt;
            &lt;div class="hidden sm:flex items-center gap-2 text-xs text-neutral-400"&gt;
                &lt;span class="w-10"&gt;Volume&lt;/span&gt;
                &lt;input id="volume" type="range" min="0" max="1" step="0.01" class="w-24 md:w-32" value="0.7"&gt;
            &lt;/div&gt;

            &lt;!-- Request and Listen Buttons --&gt;
            &lt;button id="requestBtnBar" class="hidden sm:inline-flex flex-shrink-0 text-sm bg-neutral-800 hover:bg-neutral-700 border border-neutral-700 rounded-xl px-3 py-2 transition-colors duration-200"&gt;Request Song&lt;/button&gt;
            
            &lt;!-- Help Trigger for Requests --&gt;
            &lt;span id="helpRequests" class="help-trigger" data-target="step-3-content" aria-label="Configure Request URL"&gt;?&lt;/span&gt; 
        &lt;/div&gt;
        &lt;audio id="player" preload="none" crossorigin="anonymous"&gt;&lt;/audio&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Main Content (Now Playing Section) --&gt;
&lt;section class="mx-auto max-w-6xl px-4 sm:px-6 py-12 pb-32 md:pb-24"&gt;
    &lt;div class="grid md:grid-cols-[200px,1fr] gap-8 items-start"&gt;
        &lt;!-- Artwork --&gt;
        &lt;div class="aspect-square w-full rounded-2xl overflow-hidden bg-neutral-800 shadow-xl mx-auto md:mx-0 relative"&gt;
            &lt;!-- Help Trigger for Artwork --&gt;
            &lt;span id="helpArtwork" class="help-trigger absolute top-2 right-2 z-30" data-target="step-4-content" aria-label="Configure Artwork Paths"&gt;?&lt;/span&gt;
            &lt;!-- IMPORTANT: Replace with a local placeholder image path --&gt;
            &lt;img id="nowArt" src="./assets/default_art.png" alt="Now playing artwork" class="h-full w-full object-cover transition-all duration-500 hover:scale-[1.03]"&gt;
        &lt;/div&gt;
        
        &lt;!-- Track Details and Visualizer --&gt;
        &lt;div&gt;
            &lt;h2 class="text-3xl font-bold flex items-center gap-3"&gt;
                &lt;span id="stationNameHeader"&gt;YOUR STATION&lt;/span&gt; 
                &lt;!-- Help Trigger for Station Name --&gt;
                &lt;span id="helpStationName" class="help-trigger" data-target="step-2-content" aria-label="Configure Station Name"&gt;?&lt;/span&gt; 
                &lt;span id="liveBadge" class="live-badge hidden"&gt;LIVE&lt;/span&gt;
            &lt;/h2&gt;
            &lt;p id="nowArtistMain" class="mt-2 text-neutral-400 text-lg transition-all duration-300"&gt;—&lt;/p&gt;
            &lt;p id="nowTrackMain" class="text-xl font-semibold transition-all duration-300"&gt;—&lt;/p&gt;
            &lt;p id="djRow" class="text-sm text-neutral-400 hidden mt-1"&gt;DJ: &lt;span id="djName"&gt;&lt;/span&gt;&lt;/p&gt;
            
            &lt;!-- Visualizer --&gt;
            &lt;div class="mt-8"&gt;
                &lt;h3 class="text-xl font-semibold mb-2"&gt;Audio Visualizer&lt;/h3&gt;
                &lt;canvas id="visualizer" class="w-full h-24 rounded-lg bg-neutral-800 shadow-inner"&gt;&lt;/canvas&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;

&lt;!-- Request Popup (Frame for AzuraCast Requests) --&gt;
&lt;div id="requestPopupOverlay" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[9999]"&gt;
    &lt;div class="w-11/12 max-w-lg h-[90vh] bg-neutral-900 rounded-xl relative overflow-hidden shadow-2xl"&gt;
        &lt;button id="requestPopupClose" class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full w-8 h-8 z-10 text-2xl leading-none transition-colors duration-200"&gt;&times;&lt;/button&gt;
        &lt;iframe id="requestIframe" src="" frameborder="0" allowtransparency="true" class="w-full h-full"&gt;&lt;/iframe&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
// =================================================================
// 📻 CONFIGURATION BLOCK - EASILY CHANGE YOUR RADIO DETAILS HERE ⚙️
// =================================================================

const CONFIG = {
    // 🛑 CRITICAL STEP 1: REPLACE THIS PLACEHOLDER URL WITH YOUR OWN AZURACAST API ENDPOINT.
    // IF YOU SEE 'Failed to fetch', IT'S LIKELY BECAUSE THIS LINK IS INCORRECT OR BLOCKED.
    // Format: https://[your-azuracast-domain]/api/nowplaying/[station_shortcode]
    STATION_API: 'https://azura.typicalmedia.net/api/nowplaying/mmg_radio', 
    
    // 2. Your Radio Station's Official Name
    STATION_NAME: 'MMG Radio',
    
    // 3. AzuraCast Request Page URL (Optional - leave blank if not using requests)
    // Format: https://[your-azuracast-domain]/public/[station_shortcode]/embed-requests?theme=dark
    REQUEST_URL: 'https://azura.typicalmedia.net/public/mmg_radio/embed-requests?theme=dark',
    
    // 4. Default/Placeholder Image Paths
    DEFAULT_LOGO: 'https://placehold.co/96x96/1f2937/ffffff?text=LOGO', // Used for favicon, loading screen, and default art
    DEFAULT_ART: 'https://placehold.co/200x200/4b5563/ffffff?text=ALBUM+ART', // Fallback for album art
    DEFAULT_BACKGROUND: './assets/background.jpg', // Used in CSS, ensure it matches
};

// =================================================================
// 🎧 PLAYER INITIALIZATION AND LOGIC 🚀
// =================================================================

const player = document.getElementById('player');
const playBtn = document.getElementById('playBtn'), iconPlay = document.getElementById('iconPlay'), iconPause = document.getElementById('iconPause');
const volume = document.getElementById('volume');
const nowTitleBar = document.getElementById('nowTitleBar'), nowArtistBar = document.getElementById('nowArtistBar');
// Note: Using 'Demo' suffixes for the elements in the live player for the guide
const nowTrackMain = document.getElementById('nowTrackMainDemo'), nowArtistMain = document.getElementById('nowArtistMainDemo'), nowArt = document.getElementById('nowArt');
const liveBadgeElements = document.querySelectorAll('.live-badge');
const djRow = document.getElementById('djRow'), djName = document.getElementById('djName'), nowDJBar = document.getElementById('nowDJBar');
const requestBtnBar = document.getElementById('requestBtnBar');
const requestPopupOverlay = document.getElementById('requestPopupOverlay'), requestPopupClose = document.getElementById('requestPopupClose'), requestIframe = document.getElementById('requestIframe');
const visualizer = document.getElementById('visualizer');
const loadingScreen = document.getElementById('loadingScreen'), loadingLogo = document.getElementById('loadingLogo');
const stationOffOverlay = document.getElementById('stationOffOverlay');
const topLogo = document.getElementById('topLogo'), logoImg = document.getElementById('logoImg');
const stationNameHeader = document.getElementById('stationNameHeaderDemo');
const favicon = document.querySelector('link[rel="icon"]');

let currentStream = null, audioCtx, analyzer, sourceNode;

// Helper to safely get nested property
const get = (o, p, f = '—') => p.split('.').reduce((x, y) => x ? x[y] : undefined, o) || f;

// Update static elements based on config
document.title = `${CONFIG.STATION_NAME} | Live Player`;
if (stationNameHeader) stationNameHeader.textContent = CONFIG.STATION_NAME;
if (loadingLogo) loadingLogo.src = CONFIG.DEFAULT_LOGO;
if (logoImg) logoImg.src = CONFIG.DEFAULT_LOGO;
if (favicon) favicon.href = CONFIG.DEFAULT_LOGO;
if (CONFIG.REQUEST_URL) {
    if (requestIframe) requestIframe.src = CONFIG.REQUEST_URL;
    if (requestBtnBar) requestBtnBar.classList.remove('hidden');
} else {
    if (requestBtnBar) requestBtnBar.classList.add('hidden');
}


// Fade-in loading and star field initialization
window.addEventListener('load', () => {
    // If we want the loading screen to show, we'd add 'loadingScreen.style.display = 'flex'' here.
    // Since we temporarily disabled it, we only run the logo animation:
    if (loadingLogo) loadingLogo.classList.add('visible');
    setTimeout(() => { 
        if (loadingScreen) loadingScreen.style.opacity = 0; 
    }, 500); // Quick fade out
    setTimeout(() => { 
        if (loadingScreen) loadingScreen.style.display = 'none'; 
        if (topLogo) topLogo.classList.add('visible'); 
    }, 1000); // Fully hide and show top logo
    
    // Initialize star field for offline overlay
    if (stationOffOverlay) {
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.top = `${Math.random() * 100}vh`;
            star.style.left = `${Math.random() * 100}vw`;
            star.style.animationDelay = `${Math.random() * 5}s`;
            star.style.setProperty('--dx', `${(Math.random() - 0.5) * 50}px`);
            star.style.setProperty('--dy', `${(Math.random() - 0.5) * 50}px`);
            stationOffOverlay.appendChild(star);
        }
    }
});


// Audio controls
const setPlayingUI = (p) => {
    iconPlay.classList.toggle('hidden', p);
    iconPause.classList.toggle('hidden', !p);
};

if (playBtn) playBtn.onclick = async () => {
    if (player.paused) {
        try {
            if (!audioCtx) {
                // Initialize Audio Context and Visualizer nodes
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyzer = audioCtx.createAnalyser();
                analyzer.fftSize = 256; // Standard size for quick visualizations
                sourceNode = audioCtx.createMediaElementSource(player);
                sourceNode.connect(analyzer);
                analyzer.connect(audioCtx.destination);
                startVisualizer();
            } else if (audioCtx.state === 'suspended') {
                await audioCtx.resume();
            }
            
            if (player.src) {
                await player.play(); 
                setPlayingUI(true);
            } else {
                // Fetch stream URL if player.src is null (first play attempt)
                await fetchNow(true); 
                if (player.src) {
                    await player.play(); 
                    setPlayingUI(true);
                }
            }

        } catch (e) { 
            console.error("Audio playback error:", e);
            // Fallback UI change if playback fails (e.g., autoplay block)
            setPlayingUI(false);
        }
    } else { 
        player.pause(); 
        setPlayingUI(false); 
    }
};

if (volume) {
    volume.oninput = e => player.volume = parseFloat(e.target.value);
    player.volume = parseFloat(volume.value); // Set initial volume
}

// Request popup
if (requestBtnBar) requestBtnBar.onclick = () => { if(requestPopupOverlay) { requestPopupOverlay.classList.remove('hidden'); requestPopupOverlay.style.display = 'flex'; } };
if (requestPopupClose) requestPopupClose.onclick = () => { if(requestPopupOverlay) { requestPopupOverlay.classList.add('hidden'); requestPopupOverlay.style.display = 'none'; } };
if (requestPopupOverlay) requestPopupOverlay.onclick = e => { if (e.target === requestPopupOverlay) { if(requestPopupClose) requestPopupClose.click(); } };

// Fetch now playing data
async function fetchNow(initialPlay = false) {
    try {
        let r = await fetch(CONFIG.STATION_API, { cache: 'no-store' });
        let d = await r.json();

        // 1. Extract core data
        const songTitle = get(d, 'now_playing.song.title', '—');
        const songArtist = get(d, 'now_playing.song.artist', '—');
        const artUrl = get(d, 'now_playing.song.art');
        const dj = get(d, 'live.streamer_name') || get(d, 'now_playing.dj');
        const isLive = get(d, 'live.is_live');
        const streamUrl = get(d, 'station.listen_url');

        // 2. Update UI
        if(nowTitleBar) nowTitleBar.textContent = songTitle;
        if(nowTrackMain) nowTrackMain.textContent = songTitle;
        if(nowArtistBar) nowArtistBar.textContent = songArtist;
        if(nowArtistMain) nowArtistMain.textContent = songArtist;
        
        // Artwork logic with fallback
        if(nowArt) nowArt.src = artUrl && artUrl.startsWith('http') ? artUrl : CONFIG.DEFAULT_ART;
        
        // DJ Info
        if (dj && dj !== '—') { 
            if(djRow) djRow.classList.remove('hidden'); 
            if(djName) djName.textContent = dj; 
            if(nowDJBar) nowDJBar.textContent = dj; 
            if(nowDJBar) nowDJBar.classList.remove('hidden'); 
        } else { 
            if(djRow) djRow.classList.add('hidden'); 
            if(nowDJBar) nowDJBar.classList.add('hidden'); 
        }
        
        // Live Badge
        liveBadgeElements.forEach(badge => badge.classList.toggle('hidden', !isLive));

        // 3. Stream URL and Offline Check
        const isOffline = songTitle.toLowerCase().includes("station offline");
        if(stationOffOverlay) stationOffOverlay.style.display = isOffline ? "flex" : "none";

        if (streamUrl && streamUrl !== currentStream) {
            currentStream = streamUrl;
            player.src = currentStream;
            // Only attempt to play if initialPlay is true (user clicked button)
            if (initialPlay) {
                try {
                    await player.play();
                    setPlayingUI(true);
                } catch(e) {
                    console.warn("Autoplay prevented after stream update.", e);
                    setPlayingUI(false);
                }
            }
        }
    } catch (e) { 
        console.error('API fetch error, stream may be down or CORS issue. Attempted URL:', CONFIG.STATION_API, e);
        // Show offline overlay if API fails consistently
        if(stationOffOverlay) stationOffOverlay.style.display = "flex";
    }
    // Schedule next fetch regardless of success
    setTimeout(() => fetchNow(false), 7000);
}

// 4. Visualizer Logic
function startVisualizer() {
    if (!visualizer) return;
    const ctx = visualizer.getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, visualizer.width, 0);
    gradient.addColorStop(0, '#60a5fa');  // Blue
    gradient.addColorStop(0.5, '#f87171'); // Red
    gradient.addColorStop(1, '#fcd34d');  // Yellow

    function resize() { 
        visualizer.width = visualizer.offsetWidth; 
        visualizer.height = visualizer.offsetHeight; 
    }
    resize(); 
    window.addEventListener('resize', resize);
    
    function draw() {
        requestAnimationFrame(draw);
        if (!player || player.paused || audioCtx.state === 'suspended') {
             ctx.clearRect(0, 0, visualizer.width, visualizer.height);
             return;
        }

        const bufferLength = analyzer.frequencyBinCount;
        let arr = new Uint8Array(bufferLength);
        analyzer.getByteFrequencyData(arr);

        ctx.clearRect(0, 0, visualizer.width, visualizer.height);

        let barWidth = (visualizer.width / bufferLength) * 2.5;
        let x = 0;
        
        ctx.fillStyle = gradient; 

        for (let i = 0; i < bufferLength; i += 2) {
            let v = arr[i] / 255;
            let h = v * visualizer.height;
            
            // Draw bar from bottom up
            ctx.fillRect(x, visualizer.height - h, barWidth, h);
            
            x += barWidth + 1;
        }
    }
    draw();
}

// Initial call to start fetching data
fetchNow();
</script>


        <!-- Section 3: The Complete Code (For Copying) -->
        <!-- Note: This section remains, but the actual player HTML/JS has been moved out of the <pre> tag and into Section 2.
             The content of this pre tag now represents the final, runnable file. -->
        </section>

        <!-- Section 4: Setup Instructions (The Critical Steps) -->
        <section class="mb-12 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-2 text-gray-800">4. Setup Instructions (The Critical Steps)</h2>
            <p class="mb-4 text-gray-700">The only changes you need to make are within the **CONFIG** object in the JavaScript section of the code.</p>

            <div class="space-y-6">
                <div id="step-1-content" class="pt-2"> <!-- Target for API Arrow -->
                    <h3 class="text-xl font-medium text-gray-800">Step 1: Replace the AzuraCast API Endpoint (STATION_API)</h3>
                    <p class="text-gray-600">This is the most crucial step. You must replace the placeholder URL with your station's unique "Now Playing" API endpoint. You can find this URL in your AzuraCast dashboard.</p>
                    <pre class="mt-2 bg-gray-100 p-3 rounded-lg overflow-x-auto text-sm text-red-600 font-mono">STATION_API: '<span class="font-bold">https://your-azuracast-domain/api/nowplaying/[station_shortcode]</span>',</pre>
                </div>
                
                <div id="step-2-content" class="pt-2"> <!-- Target for Station Name ? -->
                    <h3 class="text-xl font-medium text-gray-800">Step 2: Update Station Name (STATION_NAME)</h3>
                    <p class="text-gray-600">Customize the name that appears on the player.</p>
                    <pre class="mt-2 bg-gray-100 p-3 rounded-lg overflow-x-auto text-sm text-gray-700 font-mono">STATION_NAME: '<span class="font-bold">Your Official Station Name</span>',</pre>
                </div>

                <div id="step-3-content" class="pt-2"> <!-- Target for Request Button ? -->
                    <h3 class="text-xl font-medium text-gray-800">Step 3 (Optional): Set Request URL (REQUEST_URL)</h3>
                    <p class="text-gray-600">If you want a working "Request Song" button, provide the URL to your station's public request page.</p>
                    <pre class="mt-2 bg-gray-100 p-3 rounded-lg overflow-x-auto text-sm text-gray-700 font-mono">REQUEST_URL: '<span class="font-bold">https://your-azuracast-domain/public/[shortcode]/embed-requests?theme=dark</span>',</pre>
                </div>

                <div id="step-4-content" class="pt-2"> <!-- Target for Artwork ? -->
                    <h3 class="text-xl font-medium text-gray-800">Step 4 (Optional): Update Asset Paths (DEFAULT_LOGO, DEFAULT_ART)</h3>
                    <p class="text-gray-600">Change these paths if you want to use different logo, album art, or background images.</p>
                    <pre class="mt-2 bg-gray-100 p-3 rounded-lg overflow-x-auto text-sm text-gray-700 font-mono">DEFAULT_LOGO: './path/to/your/logo.png',
DEFAULT_ART: './path/to/your/fallback_art.png',</pre>
                </div>
            </div>
        </section>

    </main>
    
    <script>
        // Copy function for the code block
        function copyCode() {
            // This copies the literal text inside the code block
            const code = document.getElementById('playerCodeBlock').textContent;
            
            // This is the correct way to copy text inside the Canvas environment
            navigator.clipboard.writeText(code).then(() => {
                const button = document.querySelector('.copy-button');
                button.textContent = 'Copied!';
                setTimeout(() => { button.textContent = 'Copy Code'; }, 2000);
            }).catch(err => {
                console.error('Could not copy text: ', err);
                document.execCommand('copy'); // Fallback command
            });
        }

        // Smooth scrolling logic for help triggers
        document.addEventListener('DOMContentLoaded', () => {
            const helpTriggers = document.querySelectorAll('.help-trigger');
            const scrollArrow = document.querySelector('.scroll-arrow');
            
            // Adjust the logo positions for the live demo
            const topLogoElement = document.getElementById('topLogo');
            if(topLogoElement) {
                topLogoElement.style.top = '100px'; 
                topLogoElement.style.left = '1rem'; 
            }

            // Handle the "?" triggers
            helpTriggers.forEach(trigger => {
                trigger.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = event.currentTarget.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        // Scroll smoothly to the element, adjusting for padding/header (100px offset)
                        window.scrollTo({
                            top: targetElement.offsetTop - 100, 
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Handle the main red scroll arrow
            if (scrollArrow) {
                scrollArrow.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = event.currentTarget.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 100, 
                            behavior: 'smooth'
                        });
                    }
                });
            }
        });
    </script>

</body>
</html>
